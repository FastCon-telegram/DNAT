# NAT Bridge Manager v3.1 - VPS Edition

üöÄ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π DNAT –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è VPS/VDS —Å–µ—Ä–≤–µ—Ä–æ–≤

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üîß Backend'—ã
- **iptables** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- **nftables** ‚Äî –±—ã—Å—Ç—Ä–µ–µ iptables –Ω–∞ 15-20%

### ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ VPS)
- **Conntrack 4M** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 200K+ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **Softirq budget 100K** ‚Äî 100K –ø–∞–∫–µ—Ç–æ–≤ –∑–∞ —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–°–µ—Ç–µ–≤—ã–µ –±—É—Ñ–µ—Ä—ã 128MB** ‚Äî –±–æ–ª—å—à–∏–µ TCP –æ–∫–Ω–∞
- **Offload GRO/GSO/TSO** ‚Äî —Ä–∞–∑–≥—Ä—É–∑–∫–∞ CPU

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
wget -O /usr/local/bin/nat-manager https://raw.githubusercontent.com/FastCon-telegram/DNAT/main/nat-manager.sh
chmod +x /usr/local/bin/nat-manager
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
sudo nat-manager
```

## –ú–µ–Ω—é

```
  1) üìã –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞
  2) ‚ûï –î–æ–±–∞–≤–∏—Ç—å
  3) ‚ö° –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
  4) üîÑ –í–∫–ª/–í—ã–∫–ª
  5) üóëÔ∏è  –£–¥–∞–ª–∏—Ç—å
  6) üìä –°—Ç–∞—Ç—É—Å
  7) üßπ –û—á–∏—Å—Ç–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã
  8) ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è DNAT
  9) üìà –°—Ç–∞—Ç—É—Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
  0) üö™ –í—ã—Ö–æ–¥
```

## –ú–µ–Ω—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```
  1) üîó Conntrack (4M —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)
  2) üìä Softirq budget (100K –ø–∞–∫–µ—Ç–æ–≤/—Ü–∏–∫–ª)
  3) üì° –°–µ—Ç–µ–≤—ã–µ –±—É—Ñ–µ—Ä—ã (128MB)
  4) üöÄ Offload (GRO/GSO/TSO)
  5) ‚ö° –ü—Ä–∏–º–µ–Ω–∏—Ç—å –í–°–Å
  6) üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ nftables
  7) üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ iptables
```

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `nat-manager`
2. –í—ã–±—Ä–∞—Ç—å `8` ‚Üí `5` (–ü—Ä–∏–º–µ–Ω–∏—Ç—å –í–°–Æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é)
3. –í—ã–±—Ä–∞—Ç—å `8` ‚Üí `6` (–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ nftables)
4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —á–µ—Ä–µ–∑ –º–µ–Ω—é `2` –∏–ª–∏ `3`

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ |
|----------|----------------|-------|
| Conntrack max | 262K | 4M |
| Softirq budget | 300 | 100K |
| Max backlog | 1000 | 250K |
| –ë—É—Ñ–µ—Ä—ã | 16MB | 128MB |
| Backend | iptables | nftables |

## –§–∞–π–ª—ã

- `/etc/nat-bridge/rules.conf` ‚Äî –ø—Ä–∞–≤–∏–ª–∞ DNAT
- `/etc/nat-bridge/config.conf` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

| –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ |
|-----------|-----------|
| VPS KVM | ‚úÖ –ü–æ–ª–Ω–∞—è |
| VPS Xen | ‚úÖ –ü–æ–ª–Ω–∞—è |
| VDS | ‚úÖ –ü–æ–ª–Ω–∞—è |
| OpenVZ | ‚ö†Ô∏è –¢–æ–ª—å–∫–æ iptables |
| Dedicated | ‚úÖ –ü–æ–ª–Ω–∞—è |

## Changelog

### v3.1-VPS
- –£–±—Ä–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –Ω–∞ VPS (XDP, Ring –±—É—Ñ–µ—Ä—ã, Coalescing, IRQ Affinity)
- –û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –£–ø—Ä–æ—â—ë–Ω–Ω–æ–µ –º–µ–Ω—é

### v3.0-XDP
- XDP –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è dedicated)
- nftables backend

### v2.2
- –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª DNAT
- –ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
